(()=>{"use strict";class b{constructor(b,t,e,i){this.handleMouseDown=e,this.handleMouseUp=i,this.canvas=document.createElement("canvas"),this.canvas.width=b,this.canvas.height=t,this.ctx=this.canvas.getContext("2d"),this.ctx.font="14px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.activeTouches={},document.body.appendChild(this.canvas),this.canvas.addEventListener("mousedown",this._handleMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this._handleMouseUp.bind(this)),this.canvas.addEventListener("touchstart",this._handleTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this._handleTouchStart.bind(this)),this.canvas.addEventListener("touchcancel",this._handleTouchEnd.bind(this)),this.canvas.addEventListener("touchend",this._handleTouchEnd.bind(this))}destroy(){this.canvas.removeEventListener("mousedown",this._handleMouseDown.bind(this)),this.canvas.removeEventListener("mouseup",this._handleMouseUp.bind(this)),this.canvas.removeEventListener("touchstart",this._handleTouchStart.bind(this)),this.canvas.removeEventListener("touchmove",this._handleTouchStart.bind(this)),this.canvas.removeEventListener("touchcancel",this._handleTouchEnd.bind(this)),this.canvas.removeEventListener("touchend",this._handleTouchEnd.bind(this))}getCanvas(){return this.canvas}getContext(){return this.ctx}clearScreen(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawCircle(b,t,e,i,o){this.ctx.beginPath(),this.ctx.arc(b,t,e,0,2*Math.PI),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.strokeStyle=o,this.ctx.stroke(),this.ctx.closePath()}drawText(b,t,e,i="black"){this.ctx.fillStyle=i,this.ctx.fillText(e,b,t)}drawRectangle(b,t,e,i,o,s){this.ctx.fillStyle=o,this.ctx.strokeStyle=s,this.ctx.fillRect(b,t,e,i),this.ctx.strokeRect(b,t,e,i)}_handleTouchStart(b){b.preventDefault();const t=b.changedTouches;for(const b of t)this.handleMouseUp(b.clientX,b.clientY,b.identifier)}_handleTouchMove(b){}_handleTouchEnd(b){b.preventDefault();const t=b.changedTouches;for(const b of t)this.handleMouseDown(b.clientX,b.clientY,b.identifier)}_handleMouseUp(b){const t=this.canvas.getBoundingClientRect(),e=b.clientX-t.left,i=b.clientY-t.top;this.handleMouseDown(e,i)}_handleMouseDown(b){const t=this.canvas.getBoundingClientRect(),e=b.clientX-t.left,i=b.clientY-t.top;this.handleMouseUp(e,i)}}const t={A1:55,"G##1":55,Bbb1:55,Cbbb1:55,Bb1:58.27,"A#1":58.27,Cbb1:58.27,"G###1":58.27,B1:61.735,"A##1":61.735,Cb1:61.735,Dbbb1:61.735,C1:65.4075,"B#1":65.4075,Dbb1:65.4075,"A###1":65.4075,Db1:69.295,"C#1":69.295,Ebbb1:69.295,"B##1":69.295,D1:73.415,"C##1":73.415,Ebb1:73.415,"B###1":73.415,Fbbb1:73.415,Eb1:77.7825,"D#1":77.7825,Fbb1:77.7825,"C###1":77.7825,E1:82.4075,"D##1":82.4075,Fb1:82.4075,Gbbb1:82.4075,F1:87.3075,"E#1":87.3075,Gbb1:87.3075,"D###1":87.3075,Gb1:92.4975,"F#1":92.4975,Abbb1:92.4975,"E##1":92.4975,G1:98,"F##1":98,Abb1:98,"E###1":98,Ab1:103.825,"G#1":103.825,Bbbb1:103.825,"F###1":103.825,A2:110,"G##2":110,Bbb2:110,Cbbb2:110,Bb2:116.54,"A#2":116.54,Cbb2:116.54,"G###2":116.54,B2:123.47,"A##2":123.47,Cb2:123.47,Dbbb2:123.47,C2:130.815,"B#2":130.815,Dbb2:130.815,"A###2":130.815,Db2:138.59,"C#2":138.59,Ebbb2:138.59,"B##2":138.59,D2:146.83,"C##2":146.83,Ebb2:146.83,"B###2":146.83,Fbbb2:146.83,Eb2:155.565,"D#2":155.565,Fbb2:155.565,"C###2":155.565,E2:164.815,"D##2":164.815,Fb2:164.815,Gbbb2:164.815,F2:174.615,"E#2":174.615,Gbb2:174.615,"D###2":174.615,Gb2:184.995,"F#2":184.995,Abbb2:184.995,"E##2":184.995,G2:196,"F##2":196,Abb2:196,"E###2":196,Ab2:207.65,"G#2":207.65,Bbbb2:207.65,"F###2":207.65,A3:220,"G##3":220,Bbb3:220,Cbbb3:220,Bb3:233.08,"A#3":233.08,Cbb3:233.08,"G###3":233.08,B3:246.94,"A##3":246.94,Cb3:246.94,Dbbb3:246.94,C3:261.63,"B#3":261.63,Dbb3:261.63,"A###3":261.63,Db3:277.18,"C#3":277.18,Ebbb3:277.18,"B##3":277.18,D3:293.66,"C##3":293.66,Ebb3:293.66,"B###3":293.66,Fbbb3:293.66,Eb3:311.13,"D#3":311.13,Fbb3:311.13,"C###3":311.13,E3:329.63,"D##3":329.63,Fb3:329.63,Gbbb3:329.63,F3:349.23,"E#3":349.23,Gbb3:349.23,"D###3":349.23,Gb3:369.99,"F#3":369.99,Abbb3:369.99,"E##3":369.99,G3:392,"F##3":392,Abb3:392,"E###3":392,Ab3:415.3,"G#3":415.3,Bbbb3:415.3,"F###3":415.3,A4:440,"G##4":440,Bbb4:440,Cbbb4:440,Bb4:466.16,"A#4":466.16,Cbb4:466.16,"G###4":466.16,B4:493.88,"A##4":493.88,Cb4:493.88,Dbbb4:493.88,C4:523.26,"B#4":523.26,Dbb4:523.26,"A###4":523.26,Db4:554.36,"C#4":554.36,Ebbb4:554.36,"B##4":554.36,D4:587.32,"C##4":587.32,Ebb4:587.32,"B###4":587.32,Fbbb4:587.32,Eb4:622.26,"D#4":622.26,Fbb4:622.26,"C###4":622.26,E4:659.26,"D##4":659.26,Fb4:659.26,Gbbb4:659.26,F4:698.46,"E#4":698.46,Gbb4:698.46,"D###4":698.46,Gb4:739.98,"F#4":739.98,Abbb4:739.98,"E##4":739.98,G4:784,"F##4":784,Abb4:784,"E###4":784,Ab4:830.6,"G#4":830.6,Bbbb4:830.6,"F###4":830.6,A5:880,"G##5":880,Bbb5:880,Cbbb5:880,Bb5:932.32,"A#5":932.32,Cbb5:932.32,"G###5":932.32,B5:987.76,"A##5":987.76,Cb5:987.76,Dbbb5:987.76,C5:1046.52,"B#5":1046.52,Dbb5:1046.52,"A###5":1046.52,Db5:1108.72,"C#5":1108.72,Ebbb5:1108.72,"B##5":1108.72,D5:1174.64,"C##5":1174.64,Ebb5:1174.64,"B###5":1174.64,Fbbb5:1174.64,Eb5:1244.52,"D#5":1244.52,Fbb5:1244.52,"C###5":1244.52,E5:1318.52,"D##5":1318.52,Fb5:1318.52,Gbbb5:1318.52,F5:1396.92,"E#5":1396.92,Gbb5:1396.92,"D###5":1396.92,Gb5:1479.96,"F#5":1479.96,Abbb5:1479.96,"E##5":1479.96,G5:1568,"F##5":1568,Abb5:1568,"E###5":1568,Ab5:1661.2,"G#5":1661.2,Bbbb5:1661.2,"F###5":1661.2,A6:1760,"G##6":1760,Bbb6:1760,Cbbb6:1760,Bb6:1864.64,"A#6":1864.64,Cbb6:1864.64,"G###6":1864.64,B6:1975.52,"A##6":1975.52,Cb6:1975.52,Dbbb6:1975.52,C6:2093.04,"B#6":2093.04,Dbb6:2093.04,"A###6":2093.04,Db6:2217.44,"C#6":2217.44,Ebbb6:2217.44,"B##6":2217.44,D6:2349.28,"C##6":2349.28,Ebb6:2349.28,"B###6":2349.28,Fbbb6:2349.28,Eb6:2489.04,"D#6":2489.04,Fbb6:2489.04,"C###6":2489.04,E6:2637.04,"D##6":2637.04,Fb6:2637.04,Gbbb6:2637.04,F6:2793.84,"E#6":2793.84,Gbb6:2793.84,"D###6":2793.84,Gb6:2959.92,"F#6":2959.92,Abbb6:2959.92,"E##6":2959.92,G6:3136,"F##6":3136,Abb6:3136,"E###6":3136,Ab6:3322.4,"G#6":3322.4,Bbbb6:3322.4,"F###6":3322.4,A7:3520,"G##7":3520,Bbb7:3520,Cbbb7:3520,Bb7:3729.28,"A#7":3729.28,Cbb7:3729.28,"G###7":3729.28,B7:3951.04,"A##7":3951.04,Cb7:3951.04,Dbbb7:3951.04,C7:4186.08,"B#7":4186.08,Dbb7:4186.08,"A###7":4186.08,Db7:4434.88,"C#7":4434.88,Ebbb7:4434.88,"B##7":4434.88,D7:4698.56,"C##7":4698.56,Ebb7:4698.56,"B###7":4698.56,Fbbb7:4698.56,Eb7:4978.08,"D#7":4978.08,Fbb7:4978.08,"C###7":4978.08,E7:5274.08,"D##7":5274.08,Fb7:5274.08,Gbbb7:5274.08,F7:5587.68,"E#7":5587.68,Gbb7:5587.68,"D###7":5587.68,Gb7:5919.84,"F#7":5919.84,Abbb7:5919.84,"E##7":5919.84,G7:6272,"F##7":6272,Abb7:6272,"E###7":6272,Ab7:6644.8,"G#7":6644.8,Bbbb7:6644.8,"F###7":6644.8,A8:7040,"G##8":7040,Bbb8:7040,Cbbb8:7040,Bb8:7458.56,"A#8":7458.56,Cbb8:7458.56,"G###8":7458.56,B8:7902.08,"A##8":7902.08,Cb8:7902.08,Dbbb8:7902.08,C8:8372.16,"B#8":8372.16,Dbb8:8372.16,"A###8":8372.16,Db8:8869.76,"C#8":8869.76,Ebbb8:8869.76,"B##8":8869.76,D8:9397.12,"C##8":9397.12,Ebb8:9397.12,"B###8":9397.12,Fbbb8:9397.12,Eb8:9956.16,"D#8":9956.16,Fbb8:9956.16,"C###8":9956.16,E8:10548.16,"D##8":10548.16,Fb8:10548.16,Gbbb8:10548.16,F8:11175.36,"E#8":11175.36,Gbb8:11175.36,"D###8":11175.36,Gb8:11839.68,"F#8":11839.68,Abbb8:11839.68,"E##8":11839.68,G8:12544,"F##8":12544,Abb8:12544,"E###8":12544,Ab8:13289.6,"G#8":13289.6,Bbbb8:13289.6,"F###8":13289.6};Object.keys(t);class e{constructor(){this.audioContext=new window.AudioContext,this.oscillators={},this.unlockAudioContext()}play(b){b.filter((b=>b in t)).forEach((b=>{if(!this.oscillators[b]){const e=this.audioContext.createOscillator();e.type="sawtooth",e.frequency.setValueAtTime(t[b],this.audioContext.currentTime);const i=this.audioContext.createGain();i.gain.value=.3,e.connect(i),i.connect(this.audioContext.destination),e.start(),this.oscillators[b]={oscillator:e,gainNode:i}}}))}stop(b){b.filter((b=>b in t)).forEach((b=>{const t=this.oscillators[b];if(t){const{oscillator:e,gainNode:i}=t;e.stop(),i.disconnect(),delete this.oscillators[b]}}))}unlockAudioContext(){if("suspended"!==this.audioContext.state)return;const b=document.body,t=["touchstart","touchend","mousedown","keydown"],e=()=>{this.audioContext.resume().then(i)},i=()=>{t.forEach((t=>b.removeEventListener(t,e)))};t.forEach((t=>b.addEventListener(t,e,!1)))}}const i=["C","D","E","F","G","A","B"],o=["Db","Eb",null,"Gb","Ab","Bb",null],s={};class n{constructor(){this.pianoKeys=this.initiatePiano(),this.audioPlayer=new e}drawPiano(b){for(const{x:t,y:e,width:i,height:o,strokeColor:s,fillColor:n}of this.pianoKeys)b.drawRectangle(t,e,i,o,n,s)}checkPianoKeys(b,t){const e=[],i=[...this.pianoKeys].reverse();for(let o of i)b>=o.x&&b<=o.x+o.width&&t>=o.y&&t<=o.y+o.height&&!this.isOverlapping(o,e)&&e.push(o);return e}checkMouseDown(b,t,e=null){const i=this.checkPianoKeys(b,t);for(const b of i)null!==e&&s[e]?(s[e].fillColor=s[e].type,this.audioPlayer.stop([s[e].value]),s[e]=null):(b.fillColor=b.type,this.audioPlayer.stop([b.value]))}checkMouseUp(b,t,e=null){const i=this.checkPianoKeys(b,t);for(const b of i)null!==e?s[e]?s[e]!==b&&(s[e].fillColor=s[e].type,this.audioPlayer.stop([s[e].value]),s[e]=b,b.fillColor="black"===b.type?"pink":"lightblue",this.audioPlayer.play([b.value])):(s[e]=b,b.fillColor="black"===b.type?"pink":"lightblue",this.audioPlayer.play([b.value])):(b.fillColor="black"===b.type?"pink":"lightblue",this.audioPlayer.play([b.value]))}isOverlapping(b,t){for(const e of t)if(!(b.x+b.width<e.x||e.x+e.width<b.x||b.y+b.height<e.y||e.y+e.height<b.y))return!0;return!1}initiatePiano(){const b=[];for(let t=0;t<23.8;t++)b.push({x:50*t,y:400,width:50,height:150,value:`${i[t%7]}${Math.ceil((t+3)/7)+1}`,fillColor:"white",strokeColor:"black",type:"white"});for(let t=0;t<23.8;t++)t%7!=2&&t%7!=6&&b.push({x:50*t+35,y:400,width:30,height:100,value:`${o[t%7]}${Math.ceil((t+3)/7)+1}`,fillColor:"black",strokeColor:"black",type:"black"});return b}}const c=["","","M","m","7","Â°7"],h=[["Db2","Ab2","Eb2","Bb3","F2","C3","G2","D3","A3","E3","B3","F#3","C#3","G#3","D#3","A#4","E#3","B#4","F##3"],["Bbb2","Fb2","Cb2","Gb2","Db2","Ab2","Eb2","Bb3","F2","C3","G2","D3","A3","E3","B3","F#3","C#3","G#3","D#3","A#4"],[["Bbb4","Db4","Fb4"],["Fb4","Ab4","Cb4"],["Cb4","Eb4","Gb4"],["Gb4","Bb4","Db4"],["Db4","F4","Ab4"],["Ab4","C4","Eb4"],["Eb4","G4","Bb4"],["Bb4","D4","F4"],["F4","A4","C4"],["C4","E4","G4"],["G4","B4","D4"],["D4","F#4","A4"],["A4","C#4","E4"],["E4","G#4","B4"],["B4","D#4","F#4"],["F#4","A#4","C#4"],["C#4","E#4","G#4"],["G#4","B#4","D#4"],["D#4","F##4","A#4"],["A#4","C##4","E#4"]],[["Bbb4","Dbb4","Fb4"],["Fb4","Abb4","Cb4"],["Cb4","Ebb4","Gb4"],["Gb4","Bbb4","Db4"],["Db4","Fb4","Ab4"],["Ab4","Cb4","Eb4"],["Eb4","Gb4","Bb4"],["Bb4","Db4","F4"],["F4","Ab4","C4"],["C4","Eb4","G4"],["G4","Bb4","D4"],["D4","F4","A4"],["A4","C4","E4"],["E4","G4","B4"],["B4","D4","F#4"],["F#4","A4","C#4"],["C#4","E4","G#4"],["G#4","B4","D#4"],["D#4","F#4","A#4"],["A#4","C#4","E#4"]],[["Bbb4","Db4","Fb4","Abb4"],["Fb4","Ab4","Cb4","Ebb4"],["Cb4","Eb4","Gb4","Bbb4"],["Gb4","Bb4","Db4","Fb4"],["Db4","F4","Ab4","Cb4"],["Ab4","C4","Eb4","Gb4"],["Eb4","G4","Bb4","Db4"],["Bb4","D4","F4","Ab4"],["F4","A4","C4","Eb4"],["C4","E4","G4","Bb4"],["G4","B4","D4","F4"],["D4","F#4","A4","C4"],["A4","C#4","E4","G4"],["E4","G#4","B4","D4"],["B4","D#4","F#4","A4"],["F#4","A#4","C#4","E4"],["C#4","E#4","G#4","B4"],["G#4","B#4","D#4","F#4"],["D#4","F##4","A#4","C#4"],["A#4","C##4","E#4","G#4"]],[["Bbb4","Dbb4","Fbb4","Abbb4"],["Fb4","Abb4","Cbb4","Ebbb4"],["Cb4","Ebb4","Gbb4","Bbbb4"],["Gb4","Bbb4","Dbb4","Fbb4"],["Db4","Fb4","Abb4","Cbb4"],["Ab4","Cb4","Ebb4","Gbb4"],["Eb4","Gb4","Bbb4","Dbb4"],["Bb4","Db4","Fb4","Abb4"],["F4","Ab4","Cb4","Ebb4"],["C4","Eb4","Gb4","Bbb4"],["G4","Bb4","Db4","Fb4"],["D4","F4","Ab4","Cb4"],["A4","C4","Eb4","Gb4"],["E4","G4","Bb4","Db4"],["B4","D4","F4","Ab4"],["F#4","A4","C4","Eb4"],["C#4","E4","G4","Bb4"],["G#4","B4","D4","F4"],["D#4","F#4","A4","C4"],["A#4","C#4","E4","G4"]]];class l{constructor(){this.accordionKeys=this.initiateAccordion(),this.registeredAccordionTouches={},this.audioPlayer=new e}checkMouseUp(b,t,e=null){const i=this.checkClick(b,t);i&&(null!==e?this.registeredAccordionTouches[e]?i!==this.registeredAccordionTouches[e]&&(this.registeredAccordionTouches[e].fillColor="white",this.audioPlayer.stop(this.registeredAccordionTouches[e].value),this.registeredAccordionTouches[e]=i,i.fillColor="lightblue",this.audioPlayer.play(i.value)):(this.registeredAccordionTouches[e]=i,i.fillColor="lightblue",this.audioPlayer.play(i.value)):"lightblue"!==i.fillColor&&(i.fillColor="lightblue",this.audioPlayer.play(i.value)))}checkMouseDown(b,t,e=null){const i=this.checkClick(b,t);i&&(null!==e&&this.registeredAccordionTouches[e]?(this.registeredAccordionTouches[e].fillColor="white",this.audioPlayer.stop(this.registeredAccordionTouches[e].value),this.registeredAccordionTouches[e]=null):"white"!==i.fillColor&&(i.fillColor="white",this.audioPlayer.stop(i.value)))}checkClick(b,t){for(const e of this.accordionKeys)if(Math.sqrt(Math.pow(b-e.x,2)+Math.pow(t-e.y,2))<=e.radius)return e;return null}drawAccordion(b){for(const{x:t,y:e,text:i,radius:o,fillColor:s,strokeColor:n}of this.accordionKeys)b.drawCircle(t,e,o,s,n),b.drawText(t,e,i)}initiateAccordion(){const b=[];let t=0;for(let e=0;e<h.length;e++){for(let i=0;i<h[e].length;i++){const o=h[e][i],s=56*i+26+t,n=e*(26*Math.sqrt(3)+4)+26,l="string"==typeof o?o.replace(/[0-9]/g,""):o.map((b=>b.replace(/[0-9]/g,"")));b.push({x:s,y:n,value:"string"==typeof o?[o]:o,text:"string"==typeof o?l:`${l[0]}${c[e]}`,radius:26,fillColor:"white",strokeColor:"black"})}t+=30}return b}}(new class{constructor(){this.destroy=!1,this.piano=new n,this.accordion=new l,this.canvasDrawer=new b(1200,800,this.checkMouseDown.bind(this),this.checkMouseUp.bind(this))}destructor(){this.destroy=!0}loop(){this.canvasDrawer.clearScreen(),this.accordion.drawAccordion(this.canvasDrawer),this.piano.drawPiano(this.canvasDrawer),this.destroy||requestAnimationFrame(this.loop.bind(this))}checkMouseUp(b,t,e=null){this.accordion.checkMouseUp(b,t,e),this.piano.checkMouseUp(b,t,e)}checkMouseDown(b,t,e=null){this.accordion.checkMouseDown(b,t,e),this.piano.checkMouseDown(b,t,e)}}).loop()})();